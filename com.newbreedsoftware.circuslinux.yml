id: com.newbreedsoftware.circuslinux
runtime: org.freedesktop.Platform
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
command: circuslinux
finish-args:    
  - --share=ipc #X11 + XShm access
  - --socket=x11
  - --socket=fallback-x11    
  - --socket=wayland #Wayland access
  - --socket=pulseaudio #Sound access
  - --persist=.circuslinux
cleanup:
  - '*.a'
  - '*.h'
  - '*.la'
  - '*.m4'
  - /include
  - /lib/pkgconfig
  - /lib/debug
  - /bin/libmikmod-config
  - /share/info
  - /share/man
modules:
  - name: mikmod
    sources:
     - type: archive
       url: "http://deb.debian.org/debian/pool/main/libm/libmikmod/libmikmod_3.3.11.1.orig.tar.gz"
       sha256: "ad9d64dfc8f83684876419ea7cd4ff4a41d8bcd8c23ef37ecb3a200a16b46d19"
  - 'shared-modules/SDL/SDL-1.2.15.json'
  - 'shared-modules/SDL/SDL_image-1.2.12.json'
  - 'shared-modules/SDL/SDL_mixer-1.2.12.json'
  - name: circuslinux
    buildsystem: simple
    #config-opts: [ "--enable-joystick"]
    build-commands:
       - ./configure --bindir=/app/bin --datadir=/app/share --enable-joystick
       - make 
       - make docdir=/app/doc bindir=/app/bin datadir=/app/share install 
       - mkdir -p /app/share/icons
       - cp /app/share/circuslinux/data/images/icon.png /app/share/icons/com.newbreedsoftware.circuslinux.png
       - install -Dm644 com.newbreedsoftware.circuslinux.desktop /app/share/applications/com.newbreedsoftware.circuslinux.desktop
    sources:
      - type: archive
        url: ftp://ftp.tuxpaint.org/unix/x/circus-linux/src/circuslinux-1.0.3.tar.gz
        sha256: bf9550ebd598a9e7d93a20d80ff466475122f8b023314bb1e07c31e8c608ce8a
      - type: patch
        path: circuslinux-1.0.3-fix-64bits-build.patch
      - type: file
        path: com.newbreedsoftware.circuslinux.desktop
